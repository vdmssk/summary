window.addEventListener('DOMContentLoaded', () => {

    let popupLink = document.querySelector('.header__btn');
    let close = document.querySelector('.close');
    let popup = document.querySelector('.popup');


    popupLink.addEventListener('click', () => {
        popup.classList.toggle('open');
    });

    close.addEventListener('click', (e) => {
        e.preventDefault();
        popup.classList.remove('open');
    });

    popup.addEventListener('click' , () => {
        popup.classList.remove('open');
    })
    

    new Swiper(".slider__one", {
        simulateTouch: false,
        loop: true,
        loopedSlides: 3,
        speed: 400,
        initialSlide: 2,
        slideActiveClass: "slide__one-active",
        slideClass: "slide__one",
        wrapperClass: "wrapper__one",
        keyboard: {
            enabled: true,
            onlyInViewport: true,
            pageUpDown: true
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        breakpoints: {
            320: {
                spaceBetween: 30,
                slidesPerView: .9,
                centeredSlides: true
            },
            420: {
                spaceBetween: 30,
                slidesPerView: 1,
                centeredSlides: true
            },
            1024: {
                spaceBetween: 30,
                slidesPerView: 2
            },
            1100: {
                spaceBetween: 30,
                slidesPerView: 3
            },
            1200: {
                spaceBetween: 30,
                slidesPerView: 6
            }
        }
    })

    let animItems = document.querySelectorAll('.anim-item');

    if (animItems.length > 0 ){
        window.addEventListener('scroll' , animScroll);
        function animScroll () {
            for (let index = 0; index < animItems.length; index++) {
                const animItem = animItems[index];
                const animItemHeight = animItem.offsetHeight;
                const animItemOffset = offset(animItem).top;
                const animStart = 4;
    
    
                let animItemPoint = window.innerHeight - animItemHeight / animStart;
                if(animItemPoint > window.innerHeight){
                    animItemPoint = window.innerHeight - window.innerHeight / animStart;
                }
    
                if((pageYOffset > animItemOffset - animItemPoint) && pageYOffset < (animItemOffset + animItemHeight)) {
                    animItem.classList.add('_active');
                } 
                else {
                    animItem.classList.remove('_active');
                }
            }
        }
    }
    
    function offset(el) {
        const rect = el.getBoundingClientRect(),
        scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
        scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        return { top: rect.top + scrollTop, left: rect.left + scrollLeft}
    }
    
    animScroll();


    const anchors = document.querySelectorAll('.header__link')

    for (let anchor of anchors) {
        anchor.addEventListener('click', function (e) {
            e.preventDefault()

            if (menuIcon.classList.contains('_active-icon')) {
                menuIcon.classList.remove('_active-icon');
                menuBody.classList.remove('_active');
            }

            const blockID = anchor.getAttribute('href')

            document.querySelector(blockID).scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            })
        })
    }

    let menuIcon = document.querySelector('.menu__icon');
    let menuBody = document.querySelector('.nav');

    if (menuIcon) {
        menuIcon.addEventListener('click', () => {
            menuIcon.classList.toggle('_active-icon');
            menuBody.classList.toggle('_active');
        })
    }


})